(window.webpackJsonp=window.webpackJsonp||[]).push([[11,1],{1020:function(e,t,n){"use strict";var r=n(58),a=n(0),i=n.n(a),o=n(1),s=n.n(o),u=n(17),c=n.n(u),l=n(16),p=n(244),f=n(612),d=n(13),m=n(6),y=n.n(m),v=n(1031),h=n(33),b=(n(1021),n(256)),g=n(7),w=n.n(g),S=n(35),O=n.n(S),I=(0,w.a.import)("util/scrollToIndex"),E=l.a.redux.actions.setViewportSpecificData,D=Object(r.b)((function(e){var t=e.viewports,n=(t.viewportSpecificData[t.activeViewportIndex]||{}).cine;return{activeEnabledElement:b.a.runCommand("getActiveViewportEnabledElement"),activeViewportCineData:n||{isPlaying:!1,cineFrameRate:24},activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{dispatchSetViewportSpecificData:function(t,n){e(E(t,n))}}}),(function(e,t,n){var r=e.activeEnabledElement,a=e.activeViewportCineData,i=e.activeViewportIndex;return{cineFrameRate:a.cineFrameRate,isPlaying:a.isPlaying,onPlayPauseChanged:function(e){var n=O()(a);n.isPlaying=!n.isPlaying,t.dispatchSetViewportSpecificData(i,{cine:n})},onFrameRateChanged:function(e){var n=O()(a);n.cineFrameRate=e,t.dispatchSetViewportSpecificData(i,{cine:n})},onClickNextButton:function(){var e=w.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0],n=t.currentImageIdIndex;n>=t.imageIds.length-1||I(r,n+1)}},onClickBackButton:function(){var e=w.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].currentImageIdIndex;0!==t&&I(r,t-1)}},onClickSkipToStart:function(){var e=w.a.getToolState(r,"stack");e&&e.data&&e.data.length&&I(r,0)},onClickSkipToEnd:function(){var e=w.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].imageIds.length-1;I(r,t)}}}}))(d.c),P=l.a.redux.actions,j=P.setLayout,k=P.setViewportActive,C=Object(r.b)((function(e){return{currentLayout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{onChange:function(t,n,r){for(var a=[],i=t.row+1,o=t.col+1,s=i*o,u=0;u<s;u++){var c=n.viewports[u],l=c&&c.plugin;c&&c.vtk&&(l="cornerstone"),a.push({plugin:l})}var p={numRows:i,numColumns:o,viewports:a};r>s-1&&e(k(0)),e(j(p))}}}),(function(e,t){var n=t.onChange,r=e.currentLayout,a=e.activeViewportIndex;return{onChange:function(e){return n(e,r,a)}}}))(d.m),x=n(76);function T(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(e){function t(e){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=A(t).call(this,e),n=!a||"object"!==R(a)&&"function"!=typeof a?L(r):a,_(L(n),"closeCineDialogIfNotApplicable",(function(){var e=n.props.dialog,t=n.state,r=t.dialogId,a=t.activeButtons,i=t.toolbarButtons;r&&(i.find((function(e){return e.options&&"CINE"===e.options.behavior}))||(e.dismiss({id:r}),a=a.filter((function(e){return e.options&&"CINE"!==e.options.behavior})),n.setState({dialogId:null,activeButtons:a})))}));var i=H.call(L(n));return n.state={toolbarButtons:i,activeButtons:[]},n.seriesPerStudyCount=[],n._handleBuiltIn=W.bind(L(n)),n._onDerivedDisplaySetsLoadedAndCached=n._onDerivedDisplaySetsLoadedAndCached.bind(L(n)),n.updateButtonGroups(),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(t,e),n=t,(r=[{key:"updateButtonGroups",value:function(){var e=this,t=b.c.modules[f.a.PANEL];this.buttonGroups={left:[],right:[]},t.forEach((function(t){var n=t.module,r=Array.from(n.defaultContext);n.menuOptions.forEach((function(t){var n=Array.from(t.context||r),a=e.props.activeContexts.some((function(e){return n.includes(e)})),i="function"==typeof t.isDisabled&&t.isDisabled(e.props.studies,e.props.activeViewport);if(a&&!i){var o={value:t.target,icon:t.icon,bottomLabel:t.label},s=t.from||"right";e.buttonGroups[s].push(o)}}))})),this.buttonGroups.left.unshift({value:"studies",icon:"th-large",bottomLabel:this.props.t("Series")})}},{key:"componentDidMount",value:function(){document.addEventListener("deriveddisplaysetsloadedandcached",this._onDerivedDisplaySetsLoadedAndCached)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("deriveddisplaysetsloadedandcached",this._onDerivedDisplaySetsLoadedAndCached)}},{key:"_onDerivedDisplaySetsLoadedAndCached",value:function(){this.updateButtonGroups(),this.setState({toolbarButtons:H.call(this)})}},{key:"componentDidUpdate",value:function(e){var t=e.activeContexts!==this.props.activeContexts,n=e.studies,r=e.activeViewport,a=this.props.activeViewport,i=this.props.studies,o=this.seriesPerStudyCount,s=!1;if(n.length!==i.length||r!==a)s=!0;else for(var u=0;u<i.length;u++)if(i[u].series.length!==o[u]){o[u]=i[u].series.length,s=!0;break}s&&this.updateButtonGroups(),t&&this.setState({toolbarButtons:H.call(this)},this.closeCineDialogIfNotApplicable)}},{key:"render",value:function(){var e=this,t=B.call(this,this.state.toolbarButtons,this.state.activeButtons),n=function(t,n){e.props.handleSidePanelChange(t,n)},r=n.bind(this,"left"),a=n.bind(this,"right");return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"ToolbarRow"},i.a.createElement("div",{className:"pull-left m-t-1 p-y-1",style:{padding:"10px"}},i.a.createElement(d.v,{options:this.buttonGroups.left,value:this.props.selectedLeftSidePanel||"",onValueChanged:r})),t,i.a.createElement(C,null),i.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},this.buttonGroups.right.length&&i.a.createElement(d.v,{options:this.buttonGroups.right,value:this.props.selectedRightSidePanel||"",onValueChanged:a}))))}}])&&N(n.prototype,r),a&&N(n,a),t}(a.Component);function M(e,t){var n=e.CustomComponent;if("function"==typeof n){var r=t.map((function(e){return e.id})),a=r.includes(e.id);return i.a.createElement(n,{parentContext:this,toolbarClickCallback:G.bind(this),button:e,key:e.id,activeButtons:r,isActive:a})}}function F(e,t){var n,r=this,a=e.buttons.map((function(e){return e.onClick=G.bind(r,e),t.map((function(e){return e.id})).indexOf(e.id)>-1&&(n=e.id),e}));return i.a.createElement(d.i,{key:e.id,label:e.label,icon:e.icon,buttons:a,activeCommand:n})}function q(e,t){return i.a.createElement(d.J,{key:e.id,label:e.label,icon:e.icon,onClick:G.bind(this,e),isActive:t.map((function(e){return e.id})).includes(e.id)})}function B(e,t){var n=this;return e.map((function(e){var r=e.CustomComponent,a=e.buttons&&e.buttons.length;return r?M.call(n,e,t):a?F.call(n,e,t):q.call(n,e,t)}))}function G(e,t,n){var r=this.state.activeButtons;if(e.commandName){var a=Object.assign({evt:t},e.commandOptions);b.a.runCommand(e.commandName,a)}if("setToolActive"===e.type){var i=r.filter((function(e){var t=e.options;return t&&!t.togglable}));this.setState({activeButtons:[].concat(T(i),[e])})}else"builtIn"===e.type&&this._handleBuiltIn(e)}function H(){var e=this,t=b.c.modules[f.a.TOOLBAR],n=[];return t.forEach((function(t){var r=t.module,a=r.definitions,i=r.defaultContext;a.forEach((function(t){var r=t.context||i;e.props.activeContexts.includes(r)&&n.push(t)}))})),n}function W(e){var t=this.props,n=t.dialog,r=t.t,a=this.state.dialogId,i=e.id,o=e.options;if("CINE"===o.behavior)if(a)n.dismiss({id:a}),this.setState((function(e){return{dialogId:null,activeButtons:T(e.activeButtons.filter((function(e){return e.id!==i})))}}));else{var s=document.querySelector(".ViewerMain").getBoundingClientRect(),u=s.x,c=s.y,l=n.create({content:D,defaultPosition:{x:u+20||0,y:c+20||0}});this.setState((function(t){return{dialogId:l,activeButtons:[].concat(T(t.activeButtons),[e])}}))}"DOWNLOAD_SCREEN_SHOT"===o.behavior&&b.a.runCommand("showDownloadViewportModal",{title:r("Download High Quality Image")})}_(V,"propTypes",{isLeftSidePanelOpen:s.a.bool.isRequired,isRightSidePanelOpen:s.a.bool.isRequired,selectedLeftSidePanel:s.a.string.isRequired,selectedRightSidePanel:s.a.string.isRequired,handleSidePanelChange:s.a.func.isRequired,activeContexts:s.a.arrayOf(s.a.string).isRequired,studies:s.a.array,t:s.a.func.isRequired,dialog:s.a.any,modal:s.a.any}),_(V,"defaultProps",{studies:[]});var J=Object(h.d)(["Common","ViewportDownloadForm"])(Object(d.U)(Object(d.T)(Object(x.e)(V))));l.a.utils.studyMetadataManager;var K=l.a.redux.actions.setActiveViewportSpecificData,Y=Object(r.b)((function(e,t){var n=e.loading.progress,r=O()(t.studies);return r.forEach((function(e){e.thumbnails.forEach((function(e){var t=e.displaySetInstanceUID,r="StackProgress:".concat(t),a=n[r],i=0;a&&(i=a.percentComplete),e.stackPercentComplete=i}))})),{studies:r}}),(function(e,t){return{onThumbnailClick:function(n){var r=function(e,t){return Array.isArray(e)&&e.reduce((function(e,t){var n=[];return t&&Array.isArray(t.displaySets)&&(n=t.displaySets),e.concat(n)}),[]).find((function(e){return e.displaySetInstanceUID===t}))||null}(t.studyMetadata,n);if(r.isDerived){var a=r.Modality;if(!(r=r.getSourceDisplaySet(t.studyMetadata)))throw new Error("Referenced series for ".concat(a," dataset not present."));if(!r)throw new Error("Source data not present")}e(K(r))}}}))(d.B),z=(n(1022),n(1023),n(134)),Q=n(176);n(1024);function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Z=function(e){var t=e.children,n=e.onDrop,r=e.viewportIndex,a=e.className,o=X(Object(Q.d)({accept:"thumbnail",drop:function(e,t){var a=t.canDrop(),i=t.isOver();if(a&&i&&n){var o=e.StudyInstanceUID,s=e.displaySetInstanceUID;n({viewportIndex:r,StudyInstanceUID:o,displaySetInstanceUID:s})}},collect:function(e){return{highlighted:e.canDrop(),hovered:e.isOver()}}}),2),s=o[0],u=s.hovered,l=s.highlighted,p=o[1];return i.a.createElement("div",{className:c()("viewport-drop-target",{hovered:u},{highlighted:l},a),ref:p,"data-cy":"viewport-container-".concat(r)},t)};Z.propTypes={children:s.a.node.isRequired,viewportIndex:s.a.number.isRequired,onDrop:s.a.func.isRequired,className:s.a.string};var $=Z;var ee=n(1025),te=n.n(ee),ne=z.a.loadAndCacheDerivedDisplaySets,re=function(e){var t=e.activeViewportIndex,n=e.availablePlugins,r=e.defaultPlugin,o=e.layout,s=e.numRows,u=e.numColumns,l=e.setViewportData,p=e.studies,f=e.viewportData,m=e.children,y=e.isStudyLoaded,v=100/s,h=100/u;if(!f||!f.length)return null;var b=Object(d.S)(),g=Object(d.Q)();Object(a.useEffect)((function(){y&&f.forEach((function(e){ne(e,p).forEach((function(e){e.catch((function(e){g.error({error:e,message:e.message}),b.show({title:"Error loading derived display set:",message:e.message,type:"error",error:e,autoClose:!1})}))}))}))}),[p,f,y,b]);var w=i.a.useMemo((function(){return o.viewports.map((function(e,a){var o=f[a];if(!o)return null;var s={displaySet:o,studies:p},u=!e.plugin&&o&&o.plugin?o.plugin:e.plugin,d=function(e,t,n,r,a,o){if(e.displaySet){var s=r[a=a||o];if(!s)throw new Error("No Viewport Component available for name ".concat(a,".\n         Available plugins: ").concat(JSON.stringify(r)));return i.a.createElement(s,{viewportData:e,viewportIndex:t,children:[n]})}return i.a.createElement(te.a,null)}(s,a,m,n,u,r);return i.a.createElement($,{onDrop:l,viewportIndex:a,className:c()("viewport-container",{active:t===a}),key:a},d)}))}),[o,f,p,m,n,r,l,t]);return i.a.createElement("div",{"data-cy":"viewprt-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(s,", ").concat(v,"%)"),gridTemplateColumns:"repeat(".concat(u,", ").concat(h,"%)"),height:"100%",width:"100%"}},w)};re.propTypes={viewportData:s.a.array.isRequired,supportsDrop:s.a.bool.isRequired,activeViewportIndex:s.a.number.isRequired,layout:s.a.object.isRequired,availablePlugins:s.a.object.isRequired,setViewportData:s.a.func.isRequired,studies:s.a.array,children:s.a.node,defaultPlugin:s.a.string,numRows:s.a.number.isRequired,numColumns:s.a.number.isRequired},re.defaultProps={viewportData:[],numRows:1,numColumns:1,layout:{viewports:[{}]},activeViewportIndex:0,supportsDrop:!0,availablePlugins:{DefaultViewport:function(e){return React.createElement("div",null,JSON.stringify(e))}},defaultPlugin:"defaultViewportPlugin"};var ae=re,ie=n(637),oe=n.n(ie),se=oe()((function(e){var t={};return e.forEach((function(e){t[e.extensionId]=e.module})),t})),ue=Object(r.b)((function(e){var t,n=b.c.modules[f.a.VIEWPORT],r=se(n);n.length&&(t=n[0].extensionId);var a=e.viewports;return{numRows:a.numRows,numColumns:a.numColumns,layout:a.layout,activeViewportIndex:a.activeViewportIndex,availablePlugins:r,defaultPlugin:t}}),null)(ae),ce=n(1042),le=n.n(ce);function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var he=oe()(le.a),be=function(e){function t(e){var n,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=de(t).call(this,e),n=!a||"object"!==pe(a)&&"function"!=typeof a?me(r):a,ve(me(n),"fillEmptyViewportPanes",(function(){var e=[],t=n.props,r=t.layout,a=t.viewportSpecificData,i=n.state.displaySets;if(i&&i.length){for(var o=0;o<r.viewports.length;o++){var s=a[o];if(s&&s.StudyInstanceUID&&s.displaySetInstanceUID)e.push({StudyInstanceUID:s.StudyInstanceUID,displaySetInstanceUID:s.displaySetInstanceUID});else{var u=i.find((function(t){return!e.some((function(e){return e.displaySetInstanceUID===t.displaySetInstanceUID}))}))||i[i.length-1];e.push(u)}}e.forEach((function(e,t){e&&e.StudyInstanceUID&&n.setViewportData({viewportIndex:t,StudyInstanceUID:e.StudyInstanceUID,displaySetInstanceUID:e.displaySetInstanceUID})}))}})),ve(me(n),"setViewportData",(function(e){var t=e.viewportIndex,r=e.StudyInstanceUID,a=e.displaySetInstanceUID,i=n.findDisplaySet(n.props.studies,r,a);if(i.isDerived){var o=i.Modality;if(!(i=i.getSourceDisplaySet(n.props.studies)))throw new Error("Referenced series for ".concat(o," dataset not present."))}n.props.setViewportSpecificData(t,i)})),n.state={displaySets:[]},n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,e),n=t,(r=[{key:"getDisplaySets",value:function(e){var t=[];return e.forEach((function(e){e.displaySets.forEach((function(e){e.plugin||(e.plugin="cornerstone"),t.push(e)}))})),t}},{key:"findDisplaySet",value:function(e,t,n){var r=e.find((function(e){return e.StudyInstanceUID===t}));if(r)return r.displaySets.find((function(e){return e.displaySetInstanceUID===n}))}},{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e},this.fillEmptyViewportPanes)}}},{key:"componentDidUpdate",value:function(e){var t=e.layout.viewports.length,n=this.props.layout.viewports.length,r=this.props.layout.viewports.some((function(e){return!!e.vtk}));if(this.props.studies!==e.studies||n!==t&&!r){var a=this.getDisplaySets(this.props.studies);this.setState({displaySets:a},this.fillEmptyViewportPanes)}}},{key:"render",value:function(){var e=this.props.viewportSpecificData,t=he(e);return i.a.createElement("div",{className:"ViewerMain"},this.state.displaySets.length&&i.a.createElement(ue,{isStudyLoaded:this.props.isStudyLoaded,studies:this.props.studies,viewportData:t,setViewportData:this.setViewportData}))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach((function(t){e.props.clearViewportSpecificData(t)}))}}])&&fe(n.prototype,r),a&&fe(n,a),t}(a.Component);ve(be,"propTypes",{activeViewportIndex:s.a.number.isRequired,studies:s.a.array,viewportSpecificData:s.a.object.isRequired,layout:s.a.object.isRequired,setViewportSpecificData:s.a.func.isRequired,clearViewportSpecificData:s.a.func.isRequired});var ge=be,we=l.a.redux.actions,Se=we.setViewportSpecificData,Oe=we.clearViewportSpecificData,Ie=Object(r.b)((function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout,viewportSpecificData:t.viewportSpecificData,viewports:e.viewports}}),(function(e){return{setViewportSpecificData:function(t,n){e(Se(t,n))},clearViewportSpecificData:function(){e(Oe())}}}))(ge),Ee=(n(1026),function(e){var t=e.from,n=e.isOpen,r=e.children,a=e.width,o="right"===t?"from-right":"from-left",s=a?{maxWidth:a,marginRight:n?"0":-1*Number.parseInt(a)}:{};return i.a.createElement("section",{style:s,className:c()("sidepanel",o,{"is-open":n})},r)});Ee.propTypes={from:s.a.string.isRequired,isOpen:s.a.bool.isRequired,children:s.a.node,width:s.a.string};var De=Ee;n(1027);function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var je=b.e.services.UIModalService,ke=function(e){var t=e.context,n=e.children;return i.a.createElement(d.g,{fallbackComponent:function(){return i.a.createElement("div",{className:"ErrorFallback",role:"alert"},i.a.createElement("p",null,"Error rendering ",t,". ",i.a.createElement("br",null)," Check the browser console for more details."))},context:t,onError:function(e,n){je.show({content:function(){var r=Pe(Object(a.useState)(!1),2),o=r[0],s=r[1];return i.a.createElement("div",{className:"ErrorFallback",role:"alert"},i.a.createElement("div",{className:"ErrorBoundaryDialog"},i.a.createElement("h3",{className:"ErrorBoundaryDialogTitle"},t,": ",i.a.createElement("span",null,e.message))),i.a.createElement("button",{className:"btn btn-primary btn-sm ErrorBoundaryDialogButton",onClick:function(){return s((function(e){return!e}))}},i.a.createElement(d.k,{name:"chevron-down",className:c()("ErrorBoundaryDialogIcon",{opened:o})}),"Stack Trace"),o&&i.a.createElement("pre",null,n))},title:"Something went wrong in ".concat(t)})}},n)};ke.propTypes={context:s.a.string.isRequired,children:s.a.node.isRequired};var Ce=ke,xe=n(80),Te=n(210),Re=n(257);n(1028),n(1043);function Ne(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,a)}function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fe=function(e){function t(e){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=Ue(t).call(this,e),n=!a||"object"!==Ae(a)&&"function"!=typeof a?_e(r):a,Me(_e(n),"state",{isLeftSidePanelOpen:!0,isRightSidePanelOpen:!1,selectedRightSidePanel:"",selectedLeftSidePanel:"studies",thumbnails:[]}),Me(_e(n),"retrieveTimepoints",(function(e){l.a.log.info("retrieveTimepoints");var t=(new Date).toISOString(),r=(new Date).toISOString();return n.props.studies&&(r=new Date("1000-01-01").toISOString(),n.props.studies.forEach((function(e){var n=y()(e.StudyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>r&&(r=n)}))),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUIDs:n.props.studyInstanceUIDs,PatientID:e.PatientID,earliestDate:t,latestDate:r,isLocked:!1}])})),Me(_e(n),"storeTimepoints",(function(e){return l.a.log.info("storeTimepoints"),Promise.resolve()})),Me(_e(n),"updateTimepoint",(function(e,t){return l.a.log.info("updateTimepoint"),Promise.resolve()})),Me(_e(n),"removeTimepoint",(function(e){return l.a.log.info("removeTimepoint"),Promise.resolve()})),Me(_e(n),"disassociateStudy",(function(e,t){return l.a.log.info("disassociateStudy"),Promise.resolve()})),Me(_e(n),"onTimepointsUpdated",(function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)})),Me(_e(n),"onMeasurementsUpdated",(function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)}));var i=n.props.activeServer,o=Object.assign({},i);return l.a.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:p.a.retrieveMeasurements,store:p.a.storeMeasurements},server:o}),l.a.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n._getActiveViewport=n._getActiveViewport.bind(_e(n)),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(t,e),n=t,(r=[{key:"componentWillUnmount",value:function(){this.props.dialog&&this.props.dialog.dismissAll()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.studies,n=e.isStudyLoaded,r=l.a.measurements,a=r.TimepointApi,i=r.MeasurementApi,o=new a("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),s=new i(o,{onMeasurementsUpdated:this.onMeasurementsUpdated});if(this.currentTimepointId="TimepointId",this.timepointApi=o,this.measurementApi=s,t){var u=t[0]&&t[0].PatientID;o.retrieveTimepoints({PatientID:u}),n&&this.measurementApi.retrieveMeasurements(u,["TimepointId"]),this.setState({thumbnails:Ge(t)})}}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.studies,r=t.isStudyLoaded;if(n!==e.studies&&this.setState({thumbnails:Ge(n)}),r&&r!==e.isStudyLoaded){var a=n[0]&&n[0].PatientID,i=this.currentTimepointId;this.timepointApi.retrieveTimepoints({PatientID:a}),this.measurementApi.retrieveMeasurements(a,[i])}}},{key:"_getActiveViewport",value:function(){return this.props.viewports[this.props.activeViewportIndex]}},{key:"render",value:function(){var e,t,n=this;return b.c.modules[f.a.PANEL].forEach((function(r){r.module.components.forEach((function(r){r.id===n.state.selectedRightSidePanel?t=r.component:r.id===n.state.selectedLeftSidePanel&&(e=r.component)}))})),i.a.createElement(i.a.Fragment,null,i.a.createElement(Te.a.Consumer,null,(function(e){return i.a.createElement(Re.a.Consumer,null,(function(t){return i.a.createElement(x.c.Consumer,null,(function(n){return i.a.createElement(v.a,{linkText:n.appConfig.showStudyList?"Study List":void 0,linkPath:n.appConfig.showStudyList?"/":void 0,userManager:t},e&&e.createLogoComponentFn&&e.createLogoComponentFn(i.a))}))}))})),i.a.createElement(Ce,{context:"ToolbarRow"},i.a.createElement(J,{activeViewport:this.props.viewports[this.props.activeViewportIndex],isDerivedDisplaySetsLoaded:this.props.isDerivedDisplaySetsLoaded,isLeftSidePanelOpen:this.state.isLeftSidePanelOpen,isRightSidePanelOpen:this.state.isRightSidePanelOpen,selectedLeftSidePanel:this.state.isLeftSidePanelOpen?this.state.selectedLeftSidePanel:"",selectedRightSidePanel:this.state.isRightSidePanelOpen?this.state.selectedRightSidePanel:"",handleSidePanelChange:function(e,t){var r=e&&e[0].toUpperCase()+e.slice(1),a="is".concat(r,"SidePanelOpen"),i="selected".concat(r,"SidePanel"),o=Object.assign({},n.state),s=o[a],u=o[i],c=u===t||null===t;o[i]=t||u,(!s||c)&&(o[a]=!o[a]),n.setState(o)},studies:this.props.studies})),i.a.createElement("div",{className:"FlexboxLayout"},i.a.createElement(Ce,{context:"LeftSidePanel"},i.a.createElement(De,{from:"left",isOpen:this.state.isLeftSidePanelOpen},e?i.a.createElement(e,{viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex}):i.a.createElement(Y,{studies:this.state.thumbnails,studyMetadata:this.props.studies}))),i.a.createElement("div",{className:c()("main-content")},i.a.createElement(Ce,{context:"ViewerMain"},i.a.createElement(Ie,{studies:this.props.studies,isStudyLoaded:this.props.isStudyLoaded}))),i.a.createElement(Ce,{context:"RightSidePanel"},i.a.createElement(De,{from:"right",isOpen:this.state.isRightSidePanelOpen},t&&i.a.createElement(t,{isOpen:this.state.isRightSidePanelOpen,viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex,activeViewport:this.props.viewports[this.props.activeViewportIndex],getActiveViewport:this._getActiveViewport})))))}}])&&Le(n.prototype,r),a&&Le(n,a),t}(a.Component);Me(Fe,"propTypes",{studies:s.a.arrayOf(s.a.shape({StudyInstanceUID:s.a.string.isRequired,StudyDate:s.a.string,PatientID:s.a.string,displaySets:s.a.arrayOf(s.a.shape({displaySetInstanceUID:s.a.string.isRequired,SeriesDescription:s.a.string,SeriesNumber:s.a.number,InstanceNumber:s.a.number,numImageFrames:s.a.number,Modality:s.a.string.isRequired,images:s.a.arrayOf(s.a.shape({getImageId:s.a.func.isRequired}))}))})),studyInstanceUIDs:s.a.array,activeServer:s.a.shape({type:s.a.string,wadoRoot:s.a.string}),onTimepointsUpdated:s.a.func,onMeasurementsUpdated:s.a.func,viewports:s.a.object.isRequired,activeViewportIndex:s.a.number.isRequired,isStudyLoaded:s.a.bool,dialog:s.a.object});var qe=Object(d.T)(Fe),Be=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.warningIssues&&0!==t.warningIssues.length&&(t.warningIssues.forEach((function(e){switch(e){case xe.a.DATASET_4D:n.push("The dataset is 4D.");break;case xe.a.VARYING_IMAGESDIMENSIONS:n.push("The dataset frames have different dimensions (rows, columns).");break;case xe.a.VARYING_IMAGESCOMPONENTS:n.push("The dataset frames have different components (Sample per pixel).");break;case xe.a.VARYING_IMAGESORIENTATION:n.push("The dataset frames have different orientation.");break;case xe.a.IRREGULAR_SPACING:n.push("The dataset frames have different pixel spacing.");break;case xe.a.MULTIFFRAMES:n.push("The dataset is a multiframes.")}})),n.push("The datasets is not a reconstructable 3D volume. MPR mode is not available.")),t.missingFrames&&(!t.warningIssues||t.warningIssues&&!t.warningIssues.find((function(e){return e===xe.a.DATASET_4D})))&&n.push("The datasets is missing frames: "+t.missingFrames+"."),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Ne(i,r,a,o,s,"next",e)}function s(e){Ne(i,r,a,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}(),Ge=function(e){return e.map((function(e){return{StudyInstanceUID:e.StudyInstanceUID,thumbnails:e.displaySets.map((function(e){var t,n,r=e.displaySetInstanceUID,a=e.SeriesDescription,i=e.InstanceNumber,o=e.numImageFrames,s=e.SeriesNumber;if(e.Modality&&"SEG"===e.Modality)n="SEG";else if(e.images&&e.images.length){var u=Math.floor(e.images.length/2);t=e.images[u].getImageId()}else n=e.Modality?e.Modality:"UN";return{imageId:t,altImageText:n,displaySetInstanceUID:r,SeriesDescription:a,InstanceNumber:i,numImageFrames:o,SeriesNumber:s,hasWarnings:Be(e)}}))}}))},He=l.a.redux.actions,We=He.setTimepoints,Je=He.setMeasurements,Ke=function(e){return e.servers.find((function(e){return!0===e.active}))},Ye=Object(r.b)((function(e){var t=e.viewports,n=e.servers;return{viewports:t.viewportSpecificData,activeViewportIndex:t.activeViewportIndex,activeServer:Ke(n)}}),(function(e){return{onTimepointsUpdated:function(t){e(We(t))},onMeasurementsUpdated:function(t){e(Je(t))}}}))(qe);t.a=Ye},1021:function(e,t,n){},1022:function(e,t,n){},1023:function(e,t,n){},1024:function(e,t,n){},1025:function(e,t){},1026:function(e,t,n){},1027:function(e,t,n){},1028:function(e,t,n){},1031:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(119),o=n(75),s=n(33),u=n(1),c=n.n(u),l=n(17),p=n.n(l),f=n(13),d=["ctrl","alt","shift"],m={"":[],alt:["space"],shift:[],ctrl:["f4","f5","f11","w","r","t","o","p","a","d","f","g","h","j","l","z","x","c","v","b","n","pagedown","pageup"],"ctrl+shift":["q","w","r","t","p","a","h","v","b","n"]},y=function(e){return e.join("+")},v="It's not possible to define only modifier keys (ctrl, alt and shift) as a shortcut",h="Field can't be empty.",b=[function(e){var t=e.pressedKeys;if(!(void 0===t?[]:t).length)return{hasError:!0,errorMessage:h}},function(e){var t=e.pressedKeys,n=t[t.length-1];if(d.includes(n))return{hasError:!0,errorMessage:v}},function(e){var t=e.commandName,n=e.pressedKeys,r=function(e,t,n){var r=void 0,a=y(n);for(var i in e){var o=e[i].keys;if(a===y(o)&&i!==t){r=e[i];break}}return r}(e.hotkeys,t,n);if(r)return{hasError:!0,errorMessage:'"'.concat(r.label,'" is already using the "').concat(n,'" shortcut.')}},function(e){var t=e.pressedKeys,n=void 0===t?[]:t,r=n[n.length-1],a=y(n.slice(0,n.length-1)),i=m[a];if(!!i&&i.includes(r))return{hasError:!0,errorMessage:'"'.concat(y(n),'" shortcut combination is not allowed')}}],g=n(256);n(1037);function w(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(n,!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(e){return{hotkeys:I({},e),errors:{}}},P=function(e){var t=e.commandName,n=e.pressedKeys,r=e.hotkeys,a=!0,i=!1,o=void 0;try{for(var s,u=b[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var c=(0,s.value)({commandName:t,pressedKeys:n,hotkeys:r});if(c&&c.hasError)return c}}catch(e){i=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw o}}return{errorMessage:void 0}},j=function(e){var t=[],n=Object.entries(e);if(n.length){var r=Math.ceil(n.length/2);t.push(n.slice(0,r)),t.push(n.slice(r,n.length))}return t};function k(e){var t=e.onClose,n=Object(s.c)("UserPreferencesModal").t,i=g.d.hotkeyDefaults,o=g.d.hotkeyDefinitions,u=S(Object(r.useState)(D(o)),2),c=u[0],l=u[1],m=Object(f.S)(),y=Object.keys(c.errors).some((function(e){return!!c.errors[e]})),v=Object.keys(c.hotkeys).length,h=j(c.hotkeys);return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"HotkeysPreferences"},v?a.a.createElement("div",{className:"hotkeyTable"},h.map((function(e,t){return a.a.createElement("div",{className:"hotkeyColumn",key:t},a.a.createElement("div",{className:"hotkeyHeader"},a.a.createElement("div",{className:"headerItemText text-right"},"Function"),a.a.createElement("div",{className:"headerItemText text-center"},"Shortcut")),e.map((function(e){var t=e[0],n=e[1],r=n.keys,i=n.label,o=c.errors[e[0]];return a.a.createElement("div",{key:t,className:"hotkeyRow"},a.a.createElement("div",{className:"hotkeyLabel"},i),a.a.createElement("div",{"data-key":"defaultTool",className:p()("wrapperHotkeyInput",o?"stateError":"")},a.a.createElement(f.j,{keys:r,modifier_keys:d,handleChange:function(e){!function(e,t,n){var r=P({commandName:e,pressedKeys:n,hotkeys:c.hotkeys}).errorMessage;l((function(a){return{hotkeys:I({},a.hotkeys,E({},e,I({},t,{keys:n}))),errors:I({},a.errors,E({},e,r))}}))}(t,n,e)},classNames:"preferencesInput"}),a.a.createElement("span",{className:"preferencesInputErrorMessage"},o)))})))}))):"Hotkeys definitions is empty"),a.a.createElement(f.E,{onResetPreferences:function(){var e={};i.map((function(t){var n=t.commandName,r=w(t,["commandName"]);e[n]=I({},r)})),l(D(e))},onSave:function(){var e=c.hotkeys;g.d.setHotkeys(e),localStorage.setItem("hotkey-definitions",JSON.stringify(e)),t(),m.show({message:n("SaveMessage"),type:"success"})},onCancel:t,hasErrors:y,t:n}))}k.propTypes={onClose:c.a.func};var C=n(58),x=n(243);n(1038);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(n,!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=x.a.actions;function U(e){var t=e.onClose,n=Object(C.c)(),i=Object(C.d)((function(e){var t=e.preferences;return(void 0===t?{}:t).windowLevelData})),o=A(Object(r.useState)({values:R({},i)}),2),u=o[0],c=o[1],l=Object(s.c)("UserPreferencesModal").t,p=Object(f.S)(),d=function(e){var t=e.target,n=t.dataset,r=n.key,a=n.inputname,i=t.value;u.values[r]&&u.values[r][a]&&c((function(e){return R({},e,{values:R({},e.values,N({},r,R({},e.values[r],N({},a,i))))})}))};return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"WindowLevelPreferences"},a.a.createElement("div",{className:"wlColumn"},a.a.createElement("div",{className:"wlRow header"},a.a.createElement("div",{className:"wlColumn preset"},"Preset"),a.a.createElement("div",{className:"wlColumn description"},"Description"),a.a.createElement("div",{className:"wlColumn window"},"Window"),a.a.createElement("div",{className:"wlColumn level"},"Level")),Object.keys(u.values).map((function(e,t){return a.a.createElement("div",{className:"wlRow",key:e},a.a.createElement("div",{className:"wlColumn preset"},e),a.a.createElement("div",{className:"wlColumn description"},a.a.createElement("input",{type:"text",className:"preferencesInput",value:u.values[e].description,"data-key":e,"data-inputname":"description",onChange:d})),a.a.createElement("div",{className:"wlColumn window"},a.a.createElement("input",{type:"number",className:"preferencesInput",value:u.values[e].window,"data-key":e,"data-inputname":"window",onChange:d})),a.a.createElement("div",{className:"wlColumn level"},a.a.createElement("input",{type:"number",className:"preferencesInput",value:u.values[e].level,"data-key":e,"data-inputname":"level",onChange:d})))})))),a.a.createElement(f.E,{onResetPreferences:function(){},onSave:function(){n(L.setUserPreferences({windowLevelData:u.values})),t(),p.show({message:l("SaveMessage"),type:"success"})},onCancel:t,hasErrors:!1,t:l}))}U.propTypes={onClose:c.a.func};var _=n(108);n(1039);function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function M(e){var t=e.onClose,n=Object(s.c)("UserPreferencesModal").t,i=Object(f.S)(),o=_.a.language,u=_.a.availableLanguages,c=V(Object(r.useState)(o),2),l=c[0],p=c[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"GeneralPreferences"},a.a.createElement("div",{className:"language"},a.a.createElement("label",{htmlFor:"language-select",className:"languageLabel"},"Language"),a.a.createElement(f.l,{language:l,onLanguageChange:p,languages:u}))),a.a.createElement(f.E,{onResetPreferences:function(){p(_.a.defaultLanguage)},onSave:function(){_.a.changeLanguage(l),t(),i.show({message:n("SaveMessage"),type:"success"})},onCancel:t,hasErrors:!1,t:n}))}M.propTypes={onClose:c.a.func};n(1040);var F=[{name:"Hotkeys",Component:k,customProps:{}},{name:"General",Component:M,customProps:{}},{name:"Window Level",Component:U,customProps:{}}];function q(e){var t={onClose:e.hide};return a.a.createElement(f.D,{tabs:F,customProps:t})}q.propTypes={hide:c.a.func};var B=n(260);n(1041);function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function H(e){var t=e.t,n=e.user,o=e.userManager,s=e.modal.show,u=e.useLargeLogo,c=e.linkPath,l=e.linkText,d=e.location,m=e.children,y=G(Object(r.useState)([]),2),v=y[0],h=y[1],b=l&&c;return Object(r.useEffect)((function(){var e=[{title:t("About"),icon:{name:"info"},onClick:function(){return s({content:f.a,title:t("OHIF Viewer - About")})}},{title:t("Preferences"),icon:{name:"user"},onClick:function(){return s({content:q,title:t("User Preferences")})}}];n&&o&&e.push({title:t("Logout"),icon:{name:"power-off"},onClick:function(){return o.signoutRedirect()}}),h(e)}),[h,s,t,n,o]),a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:p()("entry-header",{"header-big":u})},a.a.createElement("div",{className:"header-left-box"},d&&d.studyLink&&a.a.createElement(i.b,{to:d.studyLink,className:"header-btn header-viewerLink"},t("Back to Viewer")),m,b&&a.a.createElement(i.b,{className:"header-btn header-studyListLinkSection",to:{pathname:c,state:{studyLink:d.pathname}}},t(l))),a.a.createElement("div",{className:"header-menu"},a.a.createElement(f.f,{title:t("Options"),list:v,align:"right"}))))}H.propTypes={linkText:c.a.string,linkPath:c.a.string,useLargeLogo:c.a.bool,location:c.a.object.isRequired,children:c.a.node,t:c.a.func.isRequired,userManager:c.a.object,user:c.a.object,modal:c.a.object},H.defaultProps={useLargeLogo:!1,children:Object(B.a)()};var W=Object(s.d)(["Header","AboutModal"])(Object(o.g)(Object(f.U)(H))),J=Object(C.b)((function(e){return{user:e.oidc&&e.oidc.user}}))(W);t.a=J},1032:function(e,t,n){"use strict";var r=n(54),a=n.n(r);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(n="fileType")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"loadFile",value:function(e,t){}},{key:"getDataset",value:function(e,t){}},{key:"getStudies",value:function(e,t){}}])&&i(t.prototype,n),r&&i(t,r),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=new(function(e){function t(){var e,n,r,a,i,o,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var p=arguments.length,f=new Array(p),d=0;d<p;d++)f[d]=arguments[d];return r=this,n=!(a=(e=c(t)).call.apply(e,[this].concat(f)))||"object"!==s(a)&&"function"!=typeof a?l(r):a,i=l(n),u="application/pdf",(o="fileType")in i?Object.defineProperty(i,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[o]=u,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"loadFile",value:function(e,t){return a.a.wadouri.loadFileRequest(t)}},{key:"getDataset",value:function(e,t){var n={};return n.imageId=e.imageId||t,n}},{key:"getStudies",value:function(e,t){return this.getDefaultStudy(t)}},{key:"getDefaultStudy",value:function(e){return{StudyInstanceUID:"",StudyDate:"",StudyTime:"",AccessionNumber:"",ReferringPhysicianName:"",PatientName:"",PatientID:"",PatientBirthdate:"",PatientSex:"",StudyId:"",StudyDescription:"",series:[{SeriesInstanceUID:"",SeriesDescription:"",SeriesNumber:"",instances:[{metadata:{SOPInstanceUID:"",SOPClassUID:"1.2.840.10008.5.1.4.1.1.104.1",Rows:"",Columns:"",NumberOfFrames:0,InstanceNumber:1},getImageId:function(){return e},isLocalFile:!0}]}]}}}])&&u(n.prototype,r),i&&u(n,i),t}(o)),d=n(28);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=n(16).a.cornerstone.metadataProvider,w=new(function(e){function t(){var e,n,r,a,i,o,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,c=new Array(u),l=0;l<u;l++)c[l]=arguments[l];return r=this,n=!(a=(e=v(t)).call.apply(e,[this].concat(c)))||"object"!==m(a)&&"function"!=typeof a?h(r):a,i=h(n),s="application/dicom",(o="fileType")in i?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,e),n=t,(r=[{key:"loadFile",value:function(e,t){return a.a.wadouri.loadFileRequest(t)}},{key:"getDataset",value:function(e,t){var n={};try{var r=d.a.data.DicomMessage.readFile(e);n=d.a.data.DicomMetaDictionary.naturalizeDataset(r.dict),g.addInstance(n),n._meta=d.a.data.DicomMetaDictionary.namifyDataset(r.meta)}catch(e){console.error("Error reading dicom file",e)}return n.imageId=t,n}},{key:"getStudies",value:function(e,t){return this.getStudyFromDataset(e)}},{key:"getStudyFromDataset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.StudyInstanceUID,n=e.StudyDate,r=e.StudyTime,a=e.AccessionNumber,i=e.ReferringPhysicianName,o=e.PatientName,s=e.PatientID,u=e.PatientBirthDate,c=e.PatientSex,l=e.StudyID,p=e.StudyDescription,f=e.SeriesInstanceUID,d=e.SeriesDescription,m=e.SeriesNumber,y=e.imageId,v={metadata:e,url:y},h={SeriesInstanceUID:f,SeriesDescription:d,SeriesNumber:m,instances:[v]},b={StudyInstanceUID:t,StudyDate:n,StudyTime:r,AccessionNumber:a,ReferringPhysicianName:i,PatientName:o,PatientID:s,PatientBirthDate:u,PatientSex:c,StudyID:l,StudyDescription:p,series:[h]};return b}}])&&y(n.prototype,r),i&&y(n,i),t}(o));function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(e){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=!(a=D(t).call(this))||"object"!==S(a)&&"function"!=typeof a?P(r):a,k(P(n),"fileType",void 0),k(P(n),"loader",void 0);var i=e&&e.type;return n.loader=n.getLoader(i),n.fileType=n.loader.fileType,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,e),n=t,i=[{key:"groupSeries",value:function(e){var t=function(e,t,n){var r=1;return e.reduce((function(e,a){var i,o=a[t],s=a[n];return e[o=o||""+r++]||(e[o]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a),e[o][n]=[]),(i=e[o][n]).push.apply(i,O(s)),e}),{})};return Object.values(t(e,"StudyInstanceUID","series")).map((function(e){var n=t(e.series,"SeriesInstanceUID","instances");return e.series=Object.values(n),e}))}}],(r=[{key:"addFile",value:function(e){return a.a.wadouri.fileManager.add(e)}},{key:"loadFile",value:function(e,t){return this.loader.loadFile(e,t)}},{key:"getDataset",value:function(e,t){return this.loader.getDataset(e,t)}},{key:"getStudies",value:function(e,t){return this.loader.getStudies(e,t)}},{key:"getLoader",value:function(e){return"application/pdf"===e?f:w}}])&&E(n.prototype,r),i&&E(n,i),t}(o);function x(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){x(i,r,a,o,s,"next",e)}function s(e){x(i,r,a,o,s,"throw",e)}o(void 0)}))}}n.d(t,"a",(function(){return N}));var R=function(){var e=T(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new C(t),r=n.addFile(t),e.next=5,n.loadFile(t,r);case 5:return a=e.sent,e.next=8,n.getDataset(a,r);case 8:return i=e.sent,e.next=11,n.getStudies(i,r);case 11:return o=e.sent,e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0.name,":Error when trying to load and process local files:",e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();function N(e){return A.apply(this,arguments)}function A(){return(A=T(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(R),e.next=3,Promise.all(n);case 3:return r=e.sent,e.abrupt("return",C.groupSeries(r.flat()));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1037:function(e,t,n){},1038:function(e,t,n){},1039:function(e,t,n){},1040:function(e,t,n){},1041:function(e,t,n){},1046:function(e,t){},1047:function(e,t){},1053:function(e,t,n){},998:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(86),o=n(134),s=n(1020),u=n(1),c=n.n(u),l=n(256),p=n(247),f=n(1064),d=n(1032),m=(n(1053),n(33)),y=n(1096);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function b(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,a)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=n(1080),D=i.a.OHIFStudyMetadata,P=o.a.studyMetadataManager,j=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return r=this,a=(e=w(t)).call.apply(e,[this].concat(o)),n=!a||"object"!==v(a)&&"function"!=typeof a?S(r):a,I(S(n),"state",{studies:null,loading:!1,progress:0,error:null}),I(S(n),"updateStudies",(function(e){P.purge();var t=e.map((function(e){var t=new D(e,e.StudyInstanceUID),n=l.c.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.forEachDisplaySet((function(e){e.localFile=!0})),P.add(t),e}));n.setState({studies:t})})),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this,t=function(){var t,n=(t=regeneratorRuntime.mark((function t(){var n,r,a,i,o,s,u,c,l,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new URLSearchParams(window.location.search),r=n.get("url")){t.next=4;break}return t.abrupt("return");case 4:return e.setState({loading:!0}),t.next=7,fetch(r).then(Object(y.a)({onProgress:function(t){e.setState({progress:t.percentage})}})).then((function(e){return e.blob()}));case 7:return a=t.sent,i=new E,t.next=11,i.loadAsync(a);case 11:o=t.sent,s=[],t.t0=regeneratorRuntime.keys(o.files);case 14:if((t.t1=t.t0()).done){t.next=23;break}if(u=t.t1.value,!i.file(u)){t.next=21;break}return t.next=19,i.file(u).async("blob");case 19:c=t.sent,s.push(new File([c],u));case 21:t.next=14;break;case 23:return t.next=25,Object(d.a)(s);case 25:if(l=t.sent,p=e.updateStudies(l)){t.next=29;break}return t.abrupt("return");case 29:e.setState({studies:p,loading:!1});case 30:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,a){var i=t.apply(e,n);function o(e){b(i,r,a,o,s,"next",e)}function s(e){b(i,r,a,o,s,"throw",e)}o(void 0)}))});return function(){return n.apply(this,arguments)}}();return this.state.error?a.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):a.a.createElement(f.a,{onDrop:t,noClick:!0},(function(n){var r=n.getRootProps;return n.getInputProps,a.a.createElement("div",h({},r(),{style:{width:"100%",height:"100%"}}),e.state.studies?a.a.createElement(s.a,{studies:e.state.studies,studyInstanceUIDs:e.state.studies&&e.state.studies.map((function(e){return e.StudyInstanceUID}))}):a.a.createElement("div",{className:"drag-drop-instructions"},a.a.createElement("div",{className:"drag-drop-contents"},e.state.loading?a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{progress:e.state.progress/100}),a.a.createElement("h3",null,e.props.t("Loading..."),e.state.progress,"%")):a.a.createElement(a.a.Fragment,null,a.a.createElement("h3",{style:{cursor:"pointer"},onClick:t},"START")))))}))}}])&&g(n.prototype,r),i&&g(n,i),t}(r.Component);I(j,"propTypes",{studies:c.a.array}),t.default=Object(m.d)("Common")(j)}}]);
//# sourceMappingURL=ZipFileData.bundle.4ffe01a133b47fa078a0.js.map